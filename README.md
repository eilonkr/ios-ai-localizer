# iOS Localizer

A GitHub Action that automatically translates iOS String Catalogs using OpenAI's GPT models.

## Overview

Xcode 15 introduced [String Catalogs](https://developer.apple.com/documentation/xcode/localizing-and-varying-text-with-a-string-catalog) â€“ a new unified, auto-updating translations file designed as an alternative to the legacy `.strings` files pattern.

This GitHub Action leverages OpenAI's Completions API to automatically and continuously keep your string catalogs up-to-date with translations across multiple languages.

## Features

- **Automated Translation**: Translates missing strings in your `.xcstrings` files using OpenAI's GPT models
- **Batch Processing**: Efficiently processes multiple strings and languages in single API calls
- **Smart Detection**: Only translates strings that are missing or need updates
- **Comment Support**: Uses developer comments as context for more accurate translations
- **Selective Translation**: Respects `shouldTranslate: false` flag to skip specific strings
- **Stale Cleanup**: Automatically removes outdated strings marked as `stale`
- **Pull Request Integration**: Creates organized PRs with detailed change summaries
- **Placeholder Preservation**: Maintains string interpolation placeholders (e.g., `%@`, `%d`) in translations

## Prerequisites

Before using this action, you'll need:

1. **OpenAI API Key**: Sign up at [OpenAI](https://platform.openai.com/) and create an API key
2. **Actions Permissions**: Enable 'Read and write permissions' and 'Allow GitHub Actions to create and approve pull requests' under Actions in the repo settings.
3. **String Catalog**: An existing `.xcstrings` file in your iOS project (generated by Xcode 15 or newer)

## Usage

Add the following workflow file to your iOS project at `.github/workflows/ios-localizer.yml`:

```yaml
name: iOS Localizer

on:
  push:
    branches:
        - main
  pull_request:
        - main

jobs:
  localize:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: iOS Localizer
        uses: eilonkr/ios-localizer-action@v1
        with:
          xcstrings_file_path: 'Localizable.xcstrings'
          target_languages: 'es,fr,de,ja,zh-Hans'
          github_token: ${{ secrets.GITHUB_TOKEN }}
          openai_model: 'gpt-4o-mini'
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
```

### Configuration Options

| Input | Required | Default | Description |
|-------|----------|---------|-------------|
| `xcstrings_file_path` | No | `Localizable.xcstrings` | Path to your String Catalog file |
| `target_languages` | Yes | - | Comma-separated language codes (e.g., `es,fr,de`) |
| `github_token` | Yes | - | GitHub token for creating PRs |
| `pr_branch_prefix` | No | `ios-localizer-updates/` | Prefix for PR branch names |
| `commit_user_name` | No | `github-actions[bot]` | Git commit author name |
| `commit_user_email` | No | `github-actions[bot]@users.noreply.github.com` | Git commit author email |
| `commit_message` | No | `i18n: Update translations by iOS Localizer Action` | Commit message |
| `pr_title` | No | `iOS Localizer: Automated Localization Updates` | Pull request title |
| `pr_body` | No | `Automated localization updates by the iOS Localizer Action.` | Pull request body |
| `openai_model` | No | `gpt-4o-mini` | OpenAI model to use |

## Working with String Catalogs

### SwiftUI

Any literal string in SwiftUI text components will be automatically added to the string catalog (`.xcstrings`) file:

```swift
Text("The sunrise was particularly beautiful today.") // Will be added to the string catalog
```

To provide context for the translation API, add comments that will be reflected in the string catalog and used as context for translations:

```swift
Text("Save your progress", comment: "Button text for saving user data")
```

For strings outside of views (such as in view models or enums), use `LocalizedStringResource`:

```swift
enum Animal {
    case rabbit
    case dog
    case goose
    
    var name: LocalizedStringResource {
        switch self {
        case .rabbit:
            "Rabbit"
        case .dog:
            "Dog"
        case .goose:
            LocalizedStringResource("Goose", comment: "Bird species name")
        }
    }
}
```

**Ignoring strings**: In the string catalog, 'Mark as "Don't translate"' for strings will be ignored by this action

### UIKit

For UIKit projects, use the `String(localized:)` API, which also supports comments for context:

```swift
let welcomeMessage = String(localized: "Welcome to our app!", comment: "Greeting shown on app launch")
```

**Important**: Make sure to build your project with Xcode after adding new strings to ensure your string catalog is synchronized with your project's localizable strings.

## Roadmap

- **Additional LLM Providers**: Support for Claude, DeepSeek, and other language models
- **Multiple Catalog Tables**: Support for multiple string tables within a single catalog ([learn more](https://developer.apple.com/documentation/xcode/localizing-and-varying-text-with-a-string-catalog))
- **Translation Memory**: Cache and reuse previous translations for consistency
- **Custom Terminology**: Support for project-specific translation glossaries

## Contributing

This project welcomes contributions! Feel free to open a pull request for any of the roadmap features or other improvements you think would be useful.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.


